{% extends "base.html" %}
{% load static %}

{% block title %}Add New B.O.M{% endblock %}

{% block css %}
<link rel="stylesheet" href="https://basuriautomotive.com/assets/css/aiz-core.css">
{% endblock css %}

{% block next_page %}
<li class="breadcrumb-item text-muted active" aria-current="page"><a
        href="{% url 'products:bom-list' %}">BOM</a> / <b class="text-dark">Add<b></li>
{% endblock %}

{% block head %}
New BOM
{% endblock %}

{% block content %}
<div class="container-fluid ">
    <div class="row">
        {% comment %} <div class="col-6 card mb-4">
          <div class="card-header">
            <h5>Create BOM</h5>
          </div>
          <div class="card-body">
                <form class="mt-3 " method="post" enctype="multipart/form-data" action='.'
                    data-url='{{ request.build_absolute_uri|safe }}' id="create-product">
                    {% csrf_token %}
                    <div class="row">
                        <div class="col-12">
                            <div class="row">
                                <div class="form-group col-md-3">
                                    <label for="productCode">Main Part No.:</label>
                                    <input type="text" class="form-control" name="productCode[]" >
                                </div>
                            </div>
                            <div class="row">
                                <div id="billingFields" class="mt-4">
                                    <div class="row billing-entry">
                                        <div class="form-group col-md-3">
                                            <label for="productCode">Child Part No.:</label>
                                            <input type="text" class="form-control" name="productCode[]" >
                                        </div>
                                        <div class="form-group col-md-3">
                                            <label for="quantity">Quantity:</label>
                                            <input type="text" class="form-control" name="quantity[]" >
                                        </div>
                                        <div class="form-group col-md-2">
                                            <button type="button" class="btn btn-danger remove-billing mt-4"><i class="fa-solid fa-trash"></i></button>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-2">
                                    <button type="button" class="btn btn-primary mt-3" id="add-row"><i class="fa-solid fa-plus"></i></button>
                                    <button type="submit" class="btn btn-success mt-3" id="add-row">Add</button>
                                </div>
                            </div>
                        </div>
                    </div>
                </form>
            </div>
        </div> {% endcomment %}

        <div class="col-4 card m-3">
            <div class="card-header">
              <h5>Upload BOM File</h5>
            </div>
            <div class="card-body">
                  <form class="mt-3 " method="post" enctype="multipart/form-data" action='.'
                      data-url='{{ request.build_absolute_uri|safe }}' id="create-product">
                      {% csrf_token %}
                      {{form}}
                      <button class="btn btn-success mt-2" type="submit">Upload CSV</button>
                  </form>
              </div>
            </div>
          </div>
    </div>
</div>

{% endblock %}

{% block js %}
<script>
    $('#bom').addClass('active open');
  $('#add-bom').addClass('active')
</script>
<script src="{% static 'js/jquery.form.js'%}"></script>
<script>
    // Add Billing Field
    //document.getElementById("").addEventListener("click", function() {
    $("#add-row").click(function(){
        
        const billingFieldsDiv = document.getElementById("billingFields");
        const billingCount = billingFieldsDiv.querySelectorAll(".billing-entry").length + 1;

        const billingEntry = document.createElement("div");
        billingEntry.className = "form-row billing-entry";

        billingEntry.innerHTML = `
        <div class="row">
            <div class="form-group col-md-3">
                <label for="productCode${billingCount}">Child Part No.:</label>
                <input type="text" class="form-control" name="productCode[]" required>
            </div>
            <div class="form-group col-md-3">
                <label for="quantity${billingCount}">Quantity:</label>
                <input type="text" class="form-control" name="quantity[]" >
            </div>
            <div class="form-group col-md-2">
                <button type="button" class="btn btn-danger remove-billing mt-4"><i class="fa-solid fa-trash"></i></button>
            </div>
        </div>
        `;

        billingFieldsDiv.appendChild(billingEntry);

        // Add an event listener to the new remove button
        const newRemoveButton = billingEntry.querySelector(".remove-billing");
        newRemoveButton.addEventListener("click", function() {
            billingEntry.remove();
        });
    });

    // Remove Billing Field
    document.getElementById("billingFields").addEventListener("click", function(e) {
        if (e.target && e.target.className == "btn btn-danger remove-billing") {
            e.target.parentElement.parentElement.remove();
        }
    });
</script>
{% endblock %}