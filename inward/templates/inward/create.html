{% extends "base.html" %}
{% load static %}

{% block title %}Product Inward{% endblock %}

{% block css %}
<link rel="stylesheet" href="https://basuriautomotive.com/assets/css/aiz-core.css">
{% endblock css %}

{% block next_page %}
<li class="breadcrumb-item text-muted active" aria-current="page"><a
        href="{% url 'vendors:vendor-list' %}">Products</a> / <b class="text-dark">Inward<b></li>
{% endblock %}

{% block head %}
New Inward
{% endblock %}

{% block content %}
<div class="row">
        <div class="col-md-12 mt-3">
                <div class="card mb-4">
                  <h5 class="card-header">New Inward</h5>
                  <div class="card-body">
                    <form class="mt-3 " method="post" enctype="multipart/form-data" action='.'
                    data-url='{{ request.build_absolute_uri|safe }}' id="create-inward">
                            {% csrf_token %}
                            <div class="row">
                                <div class="d-flex align-items-start">
                                    <div class="nav flex-column nav-pills me-3" id="v-pills-tab" role="tablist" aria-orientation="vertical">
                                      <button class="nav-link active" id="v-pills-home-tab" data-bs-toggle="pill" data-bs-target="#basic-details" type="button" role="tab" aria-controls="v-pills-home" aria-selected="true">Basic Details</button>
                                      <button class="nav-link" id="v-pills-profile-tab" data-bs-toggle="pill" data-bs-target="#po-reference" type="button" role="tab" aria-controls="v-pills-profile" aria-selected="false">PO Reference</button>
                                      <button class="nav-link" id="v-pills-messages-tab" data-bs-toggle="pill" data-bs-target="#po-item" type="button" role="tab" aria-controls="v-pills-messages" aria-selected="false">Po Items</button>
                                      {% comment %} <button class="nav-link" id="v-pills-settings-tab" data-bs-toggle="pill" data-bs-target="#v-pills-settings" type="button" role="tab" aria-controls="v-pills-settings" aria-selected="false"></button> {% endcomment %}
                                    </div>
                                    
                                    <div class="tab-content col-8" id="v-pills-tabContent">
                                      <div class="tab-pane fade show active" id="basic-details" role="tabpanel" aria-labelledby="v-pills-home-tab">
                                        <div class="mb-3">
                                            <label class="form-label" for="basic-default-inword-">{{form.po_no.label}}</label>
                                            <span class="text-danger"></span>
                                            {{form.po_no}}
                                            <span class="text-danger print_error" id="po_no"></span>
                                        </div>
                                        <div class="mb-3">
                                            <label class="form-label" for="basic-default-inword-">{{form.bill_date.label}}</label>
                                            <span class="text-danger"></span>
                                            {{form.bill_date}}
                                            <span class="text-danger print_error" id="bill_date"></span>
                                        </div>
                                        <div class="mb-3">
                                            <label class="form-label" for="basic-default-inword-">{{form.bill_no.label}}</label>
                                            <span class="text-danger"></span>
                                            {{form.bill_no}}
                                            <span class="text-danger print_error" id="bill_no"></span>
                                        </div>
                                        <div class="mb-3">
                                            <label class="form-label" for="basic-default-inword-">{{form.remarks.label}}</label>
                                            <span class="text-danger"></span>
                                            {{form.remarks}}
                                            <span class="text-danger print_error" id="remarks"></span>
                                        </div>
                                      </div>
                                      <!--po-reference-->
                                      <div class="tab-pane fade" id="po-reference" role="tabpanel" aria-labelledby="v-pills-profile-tab">
                                        Vendor Details
                                        <div class="row">
                                            <div class="col-3">
                                                Name:
                                            </div>
                                            <div class="col-8">
                                                {{vendor.comany_name}}
                                            </div>
                                            <div class="col-3">
                                                Contect Person:
                                            </div>
                                            <div class="col-8">
                                                {{vendor.primary_contect_name}}
                                            </div>
                                            <div class="col-3">
                                                Mobile:
                                            </div>
                                            <div class="col-8">
                                                {{vendor.mobile}}
                                            </div>
                                            <div class="col-3">
                                                Email:
                                            </div>
                                            <div class="col-8">
                                                {% if vendor.email %}
                                                {{vendor.email}}
                                                {% else %}
                                                -
                                                {% endif %}
                                                
                                            </div>
                                            <div class="col-3">
                                                GST NO:
                                            </div>
                                            <div class="col-8">
                                                {% if vendor.gst_no %}
                                                {{vendor.gst_no}}
                                                {% else %}
                                                -
                                                {% endif %}
                                                
                                            </div>
                                            {% if vendor.secondary_contect_name %}
                                                <div class="col-3">
                                                    Contect Person 2:
                                                </div>
                                                <div class="col-8">
                                                    {{vendor.secondary_contect_name}}
                                                </div>
                                            {% endif %}
                                            {% if vendor.mobile1 %}
                                                <div class="col-3">
                                                    Alternative Mobile:
                                                </div>
                                                <div class="col-8">
                                                    {{vendor.mobile1}}
                                                </div>
                                            {% endif %}
                        
                                            {% if vendor.email1 %}
                                                <div class="col-3">
                                                    Alternative Email:
                                                </div>
                                                <div class="col-8">
                                                    {{vendor.email1}}
                                                </div>
                                            {% endif %}
                                            
                                            {% if vendor.bank_name %}
                                            <hr>
                                                <div class="col-3">
                                                    Bank Name:
                                                </div>
                                                <div class="col-8">
                                                    {{vendor.bank_name}}
                                                </div>
                                            {% endif %}
                                            {% if vendor.bank_branch_name %}
                                                <div class="col-3">
                                                    Branch Name:
                                                </div>
                                                <div class="col-8">
                                                    {{vendor.bank_branch_name}}
                                                </div>
                                            {% endif %}
                                            {% if vendor.bank_account_no %}
                                                <div class="col-3">
                                                    Account NO:
                                                </div>
                                                <div class="col-8">
                                                    {{vendor.bank_account_no}}
                                                </div>
                                            {% endif %}
                                            {% if vendor.bank_isfc %}
                                                <div class="col-3">
                                                    IFSC Code:
                                                </div>
                                                <div class="col-8">
                                                    {{vendor.bank_isfc}}
                                                </div>
                                            {% endif %}
                                            <hr>
                                            <div class="col-3">
                                                Address:
                                            </div>
                                            <div class="col-8">
                                                {{address.street}}, {{address.street2}}, {{address.city.name}}, {{address.state.name}}, {{address.country}},  - {{address.zip}}
                                            </div>
                                        </div>
                                      </div>
                                      <!--po-item-->
                                      <div class="tab-pane fade" id="po-item" role="tabpanel" aria-labelledby="v-pills-messages-tab">
                                        Items
                                        <div id="id_vendorsof_product_list">

                                        </div>
                                      </div>
                                      
                                  </div>
                                
                                <div class="col-8">
                                    
                                </div>
                                
                            </div>
                      
                    </div>
                </div>
                
        </div>
        <div class="col-md-4 mt-3">
            <div class="row">
                <div class="col-12 card">
                    <div class="row" id="inward_data">
                        
                    </div>
                </div>
            </div>
        </div>            
    </div>
    
{% endblock %}

{% block js %}
<script src="{% static 'js/jquery.form.js'%}"></script>
<script>
    $(document).ready(function () {
        var $myForm = $('#create-inward')
        $myForm.on("submit", function (event) {
            event.preventDefault()
            var formData = $(this).serialize()
            console.log(formData);
            var $thisURL = $myForm.attr('data-url') || window.location.href // or set your own url
            option = {
                method: "POST",
                url: $thisURL,
                data: formData,
                success: function (data) {
                    if (data.error) {
                        var message = "<div class='bs-toast toast fade show bg-{{message.tags}} toast-placement-ex m-2 top-0 end-0' role='alert' aria-live='assertive' aria-atomic='true' style='float:right'>" +
                            "<div class='toast-header bg-danger'>" +
                            "<strong class='mr-auto text-white'>Error</strong>" +
                            "<button type='button' class='ml-2 mb-1 close' data-dismiss='toast'>&times;</button>" +
                            "</div><div class='toast-body'>Error Occurred, Try with Manual Image Upload" +
                            "</div></div>";
                        $("#error-message").html(message);
                        $('.toast').toast('show');
                    }
                    else {
                        console.log(data)
                        creatretable(data)
                        
                        $('input[name=part]').val('');
                        $('input[name=received_qty]').val('');
                    }
                },
                error: function (data) {
                    $(".print_error").text("")
                    $("#qc_status").text("")
                    $("#part").text("")
                    $("#qc_status").text("")
                    $("#received_qty").text("")
                },
            }
            $myForm.ajaxSubmit(option)
        })
    })
</script>
<script>
    $('#inward-menu').addClass('active open');
    $('#new-inward').addClass('active')
</script>
<script>
    $(document).ready(function () {
        $("#id_vendor").change(function () {
            var id = $(this).find(":selected").val();
            $.ajax({
                type: 'GET',
                url: "{% url 'vendors:vendor-get-name' 1  %}".replace("1", id),
                success: function (response) {
                    console.log(response.vendor.name)
                    $('#vendor').text("Name:- " + response.vendor.name + " |  GST-No:-" + response.vendor.gst_no)
                    
                },
                error: function (error) {
                    console.log(error)
                }
            })
        })

        $("#id_part").change(function () {
            var id = $(this).find(":selected").val();
            $.ajax({
                type: 'GET',
                url: "{% url 'products:products-name' 1  %}".replace("1", id),
                success: function (response) {
                    console.log(response.product)
                    $('#part').text("Code:- " + response.product.code + " |  Name:-" + response.product.name)
                    
                },
                error: function (error) {
                    console.log(error)
                }
            })
        })

    });

    function creatretable(data) {
        $("#inword-data").find("tr").remove().end();
                    $("#inword-data").append(
                        $('<tr></tr>').append(
                                $('<th></th>').text("Part No"),
                                $('<th></th>').text("Part Name"),
                                $('<th></th>').text("Part QTY"),
                                $('<th></th>').text("Qc Status")
                            )
                    )
                    var table = $('#inword-data');
                    $.each(data.data.product, function(){
                        table.append(
                            $('<tr></tr>').append(
                                $('<td></td>').text(this.code),
                                $('<td></td>').text(this.name),
                                $('<td></td>').text(this.received_qty),
                                $('<td></td>').text(this.qc),
                            )
                        );
                    });
      }
</script>
{% endblock %}