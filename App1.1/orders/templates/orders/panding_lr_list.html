{% extends "base.html" %}
{% load static %}
{% load product_extras %}

{% block title %}All Orders{% endblock %}

{% block css %}

{% endblock css %}

{% block next_page %}
<li class="breadcrumb-item text-muted active" aria-current="page"><a
  href="{% url 'products:products-list' %}">Orders</a> / <b class="text-dark">Pending LR No.<b></li>
{% endblock %}

{% block head %}
Orders Of Pending LR List 
{% endblock %}

{% block content %}

<div class="container-fluid mt-3 mb-5">
  <div class="row">
    {% comment %} <div class="col-4 mb-3">
      <div class="input-group">
        <label class="input-group-text" for="inputGroupSelect01">Categories</label>
        <select class="form-select" id="inputGroupSelect01">
          <option value="0" selected>Choose...</option>
          {% for category in categories %}
          <option value={{category.id}}>{{category.name}}</option>
          {% endfor %}
        </select>
      </div>
    </div>

    <div class="col-4">
      <input type="text" class="form-control" id="id_search" name="search" placeholder="Search" />      
    </div> {% endcomment %}
    
    <div class="col-12">

      <!-- Basic Bootstrap Table -->
      <div class="card">
        
        
        {% comment %} <a class="btn btn-success col-1">Add New</a> {% endcomment %}
        <div class="table-responsive text-nowrap text-center" id="id_products_list">
          <table class="table">
            <thead>
              <tr>
                <th>No</th>
                <th>Order Date</th>
                <th>Order No</th>
                <th>Customer Name</th>
                <th>Transport</th>
                <th>Invoice No.</th>
                <th>Dispatch Date</th>              
                <th>Action</th>
              </tr>
              
            </thead>
            <tbody class="table-border-bottom-1">
              {% for order in list %}
              
              <tr>
                <td>{{forloop.counter}}</td>
                <td>{{order.0|date:"d M, Y"}}</td>
                <td>{{order.1}}</td>
                <td>{{order.2}}</td>
                <td>{{order.3}}</td>
                <td>{{order.4}}</th>            
                <td>{{order.5|date:"d M, Y"}}</td>
                <td><button type="button" class="btn btn-primary" onclick="openLRNoModal(this)">Add LR No</button></td>
              </tr>
                    
              {% endfor %}

            </tbody>
          </table>
          
        </div>
        
      </div>
      <!--/ Basic Bootstrap Table -->
    </div>
  </div>
  <div class="row container-fluid mt-2">
 
    {% if products.paginator.num_pages > 1 %}    
    {% include 'components/pagination.html' with items=products paginator=products.paginator %}
    {% endif %}
</div>
</div>
<div class="mt-5"></div>
 <!-- LR No Modal -->
 <div class="modal fade" id="lrNoModal" tabindex="-1" role="dialog" aria-labelledby="lrNoModalLabel" aria-hidden="true">
  <div class="modal-dialog" role="document">
      <div class="modal-content">
          <div class="modal-header">
              <h5 class="modal-title" id="lrNoModalLabel">Add LR No</h5>
              <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
          </div>
          <div class="modal-body">
              <!-- Form to add LR No -->
              <form class="mt-3 " method="post" enctype="multipart/form-data" action='.'
                                    data-url='{{ request.build_absolute_uri|safe }}' id="add-lr">
                                    {% csrf_token %}
                  <div class="form-group">
                      <label for="lrNoInput">LR No:</label>
                      <input type="text" class="form-control" id="lrNoInput" placeholder="Enter LR No" name="lr_no">
                  </div>
                  <div class="form-group">
                      <label for="invoiceNoInput">Invoice No:</label>
                      <input type="text" class="form-control" id="invoiceNoInput" placeholder="Invoice No" name="invoice_no" readonly>
                  </div>
              
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-outline-secondary" data-bs-dismiss="modal">
              Close
            </button>
              <button type="submit" class="btn btn-primary" onclick="saveLRNo()">Save LR No</button>
          </div>
        </form>
      </div>
  </div>
</div>

{% endblock content %}

{% block js %}
<script>
  $('#orders-menu').addClass('active open');
  $('#orders-of-lr-list').addClass('active')
</script>

<script>
  $(document).on("keyup", "#id_search", function () {
    var select = document.getElementById("inputGroupSelect01");
    var selectedOption = select.options[select.selectedIndex];
    var selectedValue = selectedOption.value;
    
    var query = this.value;
    // var category = $()
    // $.ajax({
    //     url: '/products/search/',
    //     type: 'GET',
    //     data: { 'query': query, "category":selectedValue},
    //     success: function (data) {
    //         $('#id_products_list').html(data.data);
    //     }
    // });
});
</script>
<script>
  function openLRNoModal(button) {
      // Get the row associated with the clicked button
      var row = button.closest('tr');
      // Get the Invoice No from the second column of the row
      var invoiceNo = row.cells[5].innerText;
      // Set the Invoice No in the modal input
      document.getElementById('invoiceNoInput').value = invoiceNo;
      // Open the modal
      $('#lrNoModal').modal('show');
  }

  function saveLRNo() {
      // Get the LR No value from the form
      var lrNo = document.getElementById('lrNoInput').value;
      var invoiceNo = document.getElementById('invoiceNoInput').value;
      // Use the LR No as needed, e.g., send it to the server
      console.log('LR No:', lrNo);
      // Close the modal
      $('#lrNoModal').modal('hide');
  }
</script>
<script src="{% static 'js/jquery.form.js'%}"></script>
<script>
    
  $(document).ready(function () {
      var $myForm = $('#add-lr')
      $myForm.on("submit", function (event) {
          event.preventDefault()
          var formData = $(this).serialize()
          console.log(formData)
          var $thisURL = $myForm.attr('data-url') || window.location.href // or set your own url
          option = {
              method: "POST",
              url: $thisURL,
              data: formData,
              success: function (data) {
                  if (data.error) {
                      var message = "";
                      $("#error-message").html(message);
                      $('.toast').toast('show');
                  }
                  else {
                      location.replace(data.url)
                  }
              },
              error: function (data) {
                  $(".print_error").text("")
                  
              },
          }
          $myForm.ajaxSubmit(option)
      })
  })
</script>


{% endblock js %}